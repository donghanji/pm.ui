/*
   pm.build.js ,version 1.2.1 ,updated on 2016-03-07
   module for Plugins Modules library.

   https://github.com/donghanji/pm
 */

!function(){function a(){var a=document.documentElement,b=window.innerWidth||self.innerWidth||a&&a.clientWidth||document.body.clientWidth,c=window.innerHeight||self.innerHeight||a&&a.clientHeight||document.body.clientHeight;b-=18;var d=window.pageXOffset||self.pageXOffset||a&&a.scrollLeft||document.body.scrollLeft,e=window.pageYOffset||self.pageYOffset||a&&a.scrollTop||document.body.scrollTop,f=window.innerWidth||document.body.scrollWidth||document.body.offsetWidth,g=window.innerHeight+window.scrollMaxY||document.body.scrollHeight||document.body.offsetHeight,h=b>f?b:f,i=c>g?c:g;return h-=18,[h,i,d,e,b,c]}function b(a,b){if("number"==typeof a)return a;if("string"==typeof a){if(b=b||100,/px$/.test(a))return parseFloat(a);if(/^\./.test(a))return parseFloat(a)*b;if(/%$/.test(a))return parseFloat(a)/100*b}return 0}var c=module.globals("$");module.declare("ui.boxview",[c],function(d){function e(a){var b=this,c=f.extend({},g,a);return c.el?(b.options=c,b.$el=f(c.el),b.$object=b.$el.find("["+c.src+"]"),b.length=b.$object.length,b.index=0,b.zoomed=!1,b.$el.bind("click",function(a){var d=a.target,e=f(d);if(null===d.getAttribute("data-ignore"))return e.attr(c.src)?(b.index=b.$object.index(e),b.run(e)):void 0}),void f(window).bind("resize scroll",function(a){var c=b.options.resize,d=b.options.scroll;"resize"===a.type&&c&&"function"==typeof c&&c.call(b,a)||"scroll"===a.type&&d&&"function"==typeof d&&d.call(b,a)||b.resize(a)})):console.log("there is must be an el object")}var f=d(c),g={el:null,width:null,height:null,offsetWH:200,offsetWidth:0,offsetHeight:0,speed:500,left:null,top:null,src:"data-href",auto:!1,delay:!0,modal:!0,zIndex:1e3,controls:{close:!0,content:!0,prev:!0,next:!0,caption:!0,zoom:!0},renderTo:document.body,tapmask:null,resize:null,scroll:null,start:null,loaded:null,close:null},h={image:"viewImage",ajax:"viewAjax"},i={close:function(a){a=a||{};var b=a.callback;return f('<a data-role="view-close" class="view-close"></a>').click(function(){b&&b("close")})},prev:function(a){a=a||{};var b=a.callback;return f('<a data-role="view-prev" class="view-prev">&lt;</a>').click(function(){b&&b("prev")})},next:function(a){a=a||{};var b=a.callback;return f('<a data-role="view-next" class="view-next">&gt;</a>').click(function(){b&&b("next")})},caption:function(a){return f('<label data-role="view-caption" class="view-caption"></label>')},zoom:function(a){a=a||{};var b=a.callback;return f('<a data-role="view-zoom" class="view-zoom in"/>').click(function(){b&&b("zoom")})},content:function(a){return f('<div data-role="view-content" class="view-content"/>')}};return e.prototype={init:function(){var c=this;c.options.start&&c.options.start.call(c),c.pagesize=a(),c.options.top=b(c.options.top,c.pagesize[4]),c.options.left=b(c.options.left,c.pagesize[5]);var d="yellow";c.options.modal&&(c.$mask=f('<div  class="mask view-mask" data-role="mask"/>').css({width:c.pagesize[0],height:c.pagesize[1],position:"absolute","z-index":this.options.zIndex,left:"0",top:"0"}).click(function(){var a=c.options.tapmask;a&&"function"==typeof a&&a.call(c)||c.close()}).appendTo(f(this.options.renderTo)),d="#FFF"),c.$container=f('<div class="view-box" data-role="viewbox" style="background-color:'+d+';"/>').css({position:"absolute",top:c.offset.top,left:c.offset.left,"z-index":c.options.zIndex+2,width:"0",height:"0"}).animate({width:50,height:50,top:c.options.top?c.pagesize[3]+c.options.top:c.pagesize[3]+Math.round(c.pagesize[5]/2),left:c.options.left?c.pagesize[2]+c.options.left:Math.round(c.pagesize[4]/2)}).appendTo(f(c.options.renderTo)),c.options.id&&c.$container.attr("id",c.options.id);var e=c.options.controls||{};for(var g in e){var h=e[g];if("boolean"!=typeof h&&"object"!=typeof h)if("function"!=typeof h);else{var j=h();c["$"+g]=j,c.$container.append(j)}else{var k=i[g],l=f.extend({},h,{callback:function(a){var b=c[a];b&&b.call(c)}}),j=k&&k(l);c["$"+g]=j,c.$container.append(j)}}c.$content&&c.$content.length||(c.$content=i.content(),c.$container.append(c.$content))},run:function(a,b,c){var d=this;d.$target=a,d.offset=d.$target.offset();var e=d[h[d.options.type||"image"]];!b&&d.init(),e&&e.call(d,a,b,c)},animate:function(a,b,c,d,e,f){this.$container.animate({left:b,width:c},this.options.speed).animate({top:a,height:d},this.options.speed,function(){e&&e()})},viewImage:function(a,b,c){var d=this,e=a.clone().hide().css({position:"static"}),f=new Image;d.$close&&d.$close.fadeOut(0),d.$prev&&d.$prev.fadeOut(0),d.$next&&d.$next.fadeOut(0),d.$caption&&d.$caption.fadeOut(0),d.$zoom&&d.$zoom.fadeOut(0),d.$container.addClass("loading"),d.$prev&&d.$prev.removeClass("disabled"),d.$next&&d.$next.removeClass("disabled"),d.index<=0&&d.$prev&&d.$prev.addClass("disabled"),d.index>=d.length-1&&d.$next&&d.$next.addClass("disabled"),f.onload=function(){e.attr("src",e.attr(d.options.src)),d.$content.html(e);var a=f.width,b=f.height,g=d.options.offsetHeight;c?a>=d.pagesize[4]-d.options.offsetWH&&(a=d.pagesize[4]-d.options.offsetWH,b=Math.round(a*f.height/f.width)):(a>=d.pagesize[4]-d.options.offsetWH||b>=d.pagesize[5]-d.options.offsetWH)&&(a>=d.pagesize[4]-d.options.offsetWH&&(a=d.pagesize[4]-d.options.offsetWH,b=Math.round(a*f.height/f.width)),b>=d.pagesize[5]-d.options.offsetWH&&(b=d.pagesize[5]-d.options.offsetWH,a=Math.round(b*f.width/f.height)));var h=d.$target.attr("data-view-top")||d.options.top||d.pagesize[3]+Math.round((d.pagesize[5]-b)/2),i=d.$target.attr("data-view-left")||d.options.left||Math.round((d.pagesize[4]-a)/2)-18;h=0>h?d.options.offsetWH/2:h,d.animate(h,i,a,b+g,function(){d.$container.removeClass("loading"),d.$container.find("img").css({width:a,height:b,display:"block"}).fadeIn(),d.$close&&d.$close.fadeIn(300),d.$prev&&d.$prev.fadeIn(300),d.$next&&d.$next.fadeIn(300),d.$caption&&d.$caption.fadeIn(300),d.$zoom&&d.$zoom.fadeIn(300),d.options.loaded&&d.options.loaded.call(d)}),f.onload=function(){}},f.src=e.attr(d.options.src)},viewAjax:function(a,b,c){var d=this,e=a.attr(d.options.src);return e?(d.$container.addClass("loading"),void d.$content.load(e,function(){d.$container.removeClass("loading");var a=d.$target.attr("data-view-width")||d.options.width,b=d.$target.attr("data-view-height")||d.options.height,c=d.$target.attr("data-view-top")||d.options.top||d.pagesize[3]+Math.round((d.pagesize[5]-b)/2),e=d.$target.attr("data-view-left")||d.options.left||Math.round((d.pagesize[4]-a)/2)-18;d.animate(c,e,a,b,function(){d.options.loaded&&d.options.loaded.call(d)})})):console.log("there is no url")},next:function(){if(this.index++,this.index>=this.length)return this.index=this.length-1;var a=this.$object.eq(this.index);this.run(a,!0,this.zoomed)},prev:function(){if(this.index--,this.index<0)return this.index=0;var a=this.$object.eq(this.index);this.run(a,!0,this.zoomed)},zoom:function(a){this.zoomed=!this.zoomed,this.run(this.$target,!0,this.zoomed),this.$zoom.toggleClass("out")},close:function(a){var b=this;b.$mask&&b.$mask.unbind("click"),b.$close&&b.$close.unbind("click").hide(0),b.$prev&&b.$prev.unbind("click").hide(0),b.$next&&b.$next.unbind("click").hide(0),b.$zoom&&b.$zoom.unbind("click").hide(0);var c=b.$target.offset();b.$container&&b.$container.animate({top:c.top,left:c.left,width:"0",height:"0"},b.options.speed,function(){b.$mask&&b.$mask.remove(),b.$container&&b.$container.remove(),b.$container=null,b.$content=null,b.$close=null,b.$prev=null,b.$next=null,b.$caption=null,b.$zoom=null,b.options.closed&&b.options.closed.call(b),a&&a()})},resize:function(b){var c=this;c.pagesize=a();var d=c.$container&&c.$container.outerWidth(),e=c.$container&&c.$container.outerHeight();c.$mask&&c.$mask.css({width:c.pagesize[0],height:c.pagesize[1]}),c.$zoom&&"scroll"===b.type&&c.$zoom.hasClass("out")||c.$container&&c.$container.css({top:c.pagesize[3]+Math.round((c.pagesize[5]-e)/2),left:Math.round((c.pagesize[4]-d)/2)})}},{load:function(a){return new e(a)}}})}();